
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Telnet Super App</title>
	 <!-- core:css --> 
	<link rel="stylesheet" href="../assets/vendors/core/core.css">
	 <!-- endinject --> 
  <!-- plugin css for this page --> 
  <link rel="stylesheet" href="../assets/vendors/simplemde/simplemde.min.css">
  <link rel="stylesheet" href="../assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.css">
   <!-- end plugin css for this page --> 
   <link rel="stylesheet" type="text/css" href="../assets/vendors/datatables/jquery.dataTables.min.css">
	 <!-- inject:css -->
	<link rel="stylesheet" href="../assets/fonts/feather-font/css/iconfont.css">
	<link rel="stylesheet" href="../assets/vendors/flag-icon-css/css/flag-icon.min.css">
	<link rel="stylesheet" href="../assets/vendors/mdi/css/materialdesignicons.min.css">
	 <!-- endinject --> 
  <!-- Layout styles -->   
  <link rel="stylesheet" href="../assets/css/demo_1/style.css">
  <link rel="stylesheet" href="../assets/css/demo_1/custom.css">
 <!-- End layout styles --> 
  <link rel="shortcut icon" href="../assets/images/favicon.png" />
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxy/1.6.1/scripts/jquery.ajaxy.min.js"></script>
  <link rel="stylesheet" href="../assets/vendors/font-awesome/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
</head>
<body>
	<div class="main-wrapper">

    <% if (userDetails.role == 'Staff') { %>
      <%- include('./bars/sidebar_staff') %>
      <% } else if (userDetails.role == 'Supervisor') { %>
      <%- include('./bars/sidebar_sup') %>  
      <% } else if (userDetails.role == 'Auditor') { %>
      <%- include('./bars/sidebar_auditor') %> 
      <% } else if (userDetails.role == 'Finance') { %>
      <%- include('./bars/sidebar_finance') %>
      <%  } else if (userDetails.role == 'Driver Admin') { %>
      <%- include('./bars/sidebar_driver') %>  
      <%  } else if (userDetails.role == 'Director') { %>
      <%- include('./bars/sidebar_director') %>
      <%  } else if (userDetails.role == 'Group Managing Director') { %>
      <%- include('./bars/sidebar_gmd') %>  
      <%  } else if (userDetails.role == 'Driver') { %>
      <%- include('./bars/sidebar_carDriver') %>  
      <%  } else { %>
      <%- include('./bars/sidebar') %>    
      <%  } %>
	
		<div class="page-wrapper">
				
      <%- include('./bars/topbar') %>

      
      <div class="page-content">
        <%- include('./partials/messages')%>
        <div class="row">
          <div class="col-md-2 grid-margin">
            <div class="card">
              <div class="card-body card-color-two">
                 <!-- <h6 id="totalStaff" class="card-title">Staff</h6> --> 
                <h6 class="card-title">Drivers</h6>
                <h1 id="totalDrivers">0</h1>
                <span class="dashboard" > 
                  <i class="fas fa-user-friends circleOne"></i> 
              </span>
              </div>
              
            </div>
          </div>
          <div class="col-md-2 grid-margin">
            <div class="card">
              <div class="card-body card-color-three">
                <h6 class="card-title">Trips</h6>
                <h1 id="totalTrips">0</h1>
                <span class="dashboard" > 
                  <i class="fas fa-car circleThree"></i> 
              </span>
              </div>
              
            </div>
          </div>
          <div class="col-md-3 grid-margin">
            <div class="card">
              <div class="card-body card-color-four">
                <h6 class="card-title">Total Vehicles</h6>
                <h1 id="totalVehicles">0</h1>
                <span class="dashboard" > 
                  <i class="fas fa-car circleThree"></i> 
              </span>
              </div>
              
            </div>
          </div>
          <div class="col-md-3 grid-margin">
            <div class="card">
              <div class="card-body card-color-one">
                <h6  class="card-title">Available Vehicles</h6>
                <h1 id="availableVehicles">0</h1>
                <span class="dashboard" > 
                  <i class="fas fa-car circleThree"></i> 
              </span>
              </div>
              
            </div>
          </div>
          <div class="col-md-2 grid-margin">
            <div class="card">
              <div class="card-body card-color-four">
                <h6 class="card-title">Request</h6>
                <h1 id="totalRequest">0</h1>
                <span class="dashboard" > 
                  <i class="fas fa-user-friends circleOne"></i> 
              </span>
              </div>
              
            </div>
          </div>
          <!-- <div class="col-md-2 grid-margin">
            <div class="card">
              <div class="card-body">
                <h6  class="card-title">Vehicles</h6>
                <h1 id="totalVehicles">0</h1>
              </div>
            </div>
          </div> -->
        </div>

        <div class="row">
          <div class="col-xl-12 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">Trips and Request By Subsidiary</h6>
                <canvas id="RequestInSubsidiaryID"></canvas>
              </div>
              <span class="dashboard" > 
                <i class="fas fa-user-friends circleOne"></i> 
            </span>
            </div>
          </div>
          <!-- <div class="col-xl-6 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">Request in Each Subsdiary</h6>
                <canvas id="RequestInSubsidiaryID"></canvas>
              </div>
            </div>
          </div> -->
        </div>

        <!-- <div class="row">
          <div class="col-md-12">
          <table id="TripRange" class="table table-bordered table-hover">
              <thead>
              <tr>
                <th>Request</th>
                <th>Firstname</th>
                <th>Lastname</th>
                <th>Department</th>
                <th>Subsidiary</th>
              </tr>
              </thead>
              <tbody  id="result">
               
              </tbody>
          </table>
          </div>
        </div> -->

         <!-- <div class="row">
          <div class="col-xl-6 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">Doughnut chart</h6>
                <canvas id="chartjsDoughnut"></canvas>
              </div>
            </div>
          </div>
          <div class="col-xl-6 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">Area chart</h6>
                <canvas id="chartjsArea"></canvas>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row">
          <div class="col-xl-6 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">Pie chart</h6>
                <canvas id="chartjsPie"></canvas>
              </div>
            </div>
          </div>
          <div class="col-xl-6 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">Bubble chart</h6>
                <canvas id="chartjsBubble"></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-xl-6 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">Radar chart</h6>
                <canvas id="chartjsRadar"></canvas>
              </div>
            </div>
          </div>
          <div class="col-xl-6 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">Polar area chart</h6>
                <canvas id="chartjsPolarArea"></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-xl-6 grid-margin grid-margin-xl-0 stretch-card">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">Grouped bar chart</h6>
                <canvas id="chartjsGroupedBar"></canvas>
              </div>
            </div>
          </div>
          <div class="col-xl-6 stretch-card">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">Mixed bar chart</h6>
                <canvas id="chartjsMixedBar"></canvas>
              </div>
            </div>
          </div>
        </div> --> 

			</div>

			 <!-- partial:../../partials/_footer.html --> 
       <%- include('./bars/footer') %>
			 <!-- partial --> 
	
		</div>
  </div>

  <!-- <script>
    const dashboard = document.getElementById('authors');
    const url = 'http://173.212.213.205:8090/api/v1/accounts/totals';

    





  </script> -->
  
  <script>
    $(document).ready(function(){

      // *Total No* //
      //var url = "dashboard.ejs";
      $.ajax({
        url:'/api/ajax/dashboard_total_reports',
        type:'GET',
        dataType: 'json',
        success:function(data){
            if(data){
                $('#totalDrivers').html('<h1>'+ data.total_drivers +'</h1>');
                $('#totalTrips').html('<h1>'+ data.total_trips +'</h1>');
                $('#totalVehicles').html('<h1>'+ data.total_vehicles +'</h1>');
                $('#availableVehicles').html('<h1>'+ data.available_vehicles +'</h1>');  
                $('#totalRequest').html('<h1>'+ data.total_request +'</h1>');  
                // $('#totalVehicles').html('<h1>'+ data.total_vehicle +'</h1>');  
            }               
        }, 
        error:function(data){
      //    alert('Error Retrieving data');
        }
      });

      // *RequestInSubsidiary Bar Chart right* //
    var RequestInSubsidiary = function(iteco_r, iteco_t, softworks_r, softworks_t, telnet_r, telnet_t){
        if($('#RequestInSubsidiaryID').length) {
          new Chart($("#RequestInSubsidiaryID"), {
            type: 'bar',
            data: {
              labels: [ "iTECO Trips", "iTECO Request", "Softworks Trips", "Softworks Request", "TELNET Trips", "TELNET Request"],
              datasets: [
                {
                  label: "Subsidiary",
                  backgroundColor: ["#66d1d1","#b1cfec","#fa8072, #66d1d1","#b1cfec","#fa8072"],
                  data: [iteco_r, iteco_t, softworks_r, softworks_t, telnet_r, telnet_t]
                }
              ]
            },
            options: {
              legend: { display: true },
            }
          });
        }
    }
        //var url = "dashboard.ejs";
        $.ajax({
          url:'/api/ajax/dashboard_total_subsidiary_request_type',
          type:'GET',
          dataType: 'json',
          success:function(data){
              if(data){
                let iteco_r     = data.iteco_request_count;
                let iteco_t = data.iteco_total_trips;
                let telnet_r    = data.telnet_request_count;
                let telnet_t     = data.telnet_total_trips;
                let softworks_r = data.softworks_request_count;
                let softworks_t   = data.softworks_total_trips;
                RequestInSubsidiary(iteco_r, iteco_t, softworks_r, softworks_t, telnet_r, telnet_t);
              }               
          }, 
          error:function(data){
           // alert('Error Retrieving data');
          }
        });


         // *RequestInSubsidiary Bar Chart left* //
    var TripsInSubsidiaryID = function(iteco,softworks,telnet){
        if($('#TripsInSubsidiaryID').length) {
          new Chart($("#TripsInSubsidiaryID"), {
            type: 'bar',
            data: {
              labels: [ "iTECO", "Softworks", "TELNET"],
              datasets: [
                {
                  label: "Subsidiary",
                  backgroundColor: ["#66d1d1","#7ee5e5","#5e77f9"],
                  data: [iteco,softworks,telnet]
                }
              ]
            },
            options: {
              legend: { display: true },
            }
          });
        }
    }
        //var url = "dashboard.ejs";
        $.ajax({
          url:'/api/ajax/dashboard_total_subsidiary_request_type',
          type:'GET',
          dataType: 'json',
          success:function(data){
              if(data){
                let iteco     = data.iteco_total_trips;
                let softworks = data.softworks_total_trips;
                let telnet    = data.telnet_total_trips;
                TripsInSubsidiaryID(iteco,softworks,telnet);
              }               
          }, 
          error:function(data){
           // alert('Error Retrieving data');
          }
        });

        $("#TripRange").DataTable({
      ajax: {
          url: "/api/ajax/dashboard_trip_range",
          dataSrc: ""
      },
      columns: [
          {
              data: "assigned_vehicle__vehicle_request"
          },
          {
              data: "assigned_vehicle__vehicle_request__requester__first_name"
          },
          {
              data: "assigned_vehicle__vehicle_request__requester__last_name"
          },
          {
              data: "assigned_vehicle__vehicle_request__requester__department__name"
          },
          {
              data: "assigned_vehicle__vehicle_request__requester__subsidiary__name"
          },
          
      ]
            });


    });
  </script>


<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="./myChart.js"></script>

	 <!-- core:js -->
	<script src="../assets/vendors/core/core.js"></script>
	 <!-- endinject -->
   <!-- plugin js for this page --> 
  <script src="../assets/vendors/simplemde/simplemde.min.js"></script>
  <script src="../assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
	 <!-- end plugin js for this page --> 
	 <!-- inject:js --> 
	<script src="../assets/vendors/feather-icons/feather.min.js"></script>
	<script src="../assets/js/template.js"></script>
   <!-- endinject --> 
   <script src="../assets/vendors/datatables/jquery.dataTables.min.js"></script>

  <!-- custom js for this page -->
  <script src="../assets/js/simplemde.js"></script>
  <script src="../assets/js/dashboard.js"></script>
  <script src="../assets/js/datepicker.js"></script>
  <!-- end custom js for this page --> 
  <script src="../assets/js/chartjs.js"></script>
  <script src="../assets/vendors/chartjs/Chart.min.js"></script>
  <script src="../views/pages/dashboard.ejs"></script>
</body>
</html>